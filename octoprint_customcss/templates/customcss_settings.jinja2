<script>
(async () => {
    const imp = async url => eval(await (await fetch(url)).text());
    await imp('https://unpkg.com/@monaco-editor/loader@latest/lib/umd/monaco-loader.min.js');
    let controlsDom = document.querySelector("#settings_plugin_customcss .controls");
    let textareaDom = controlsDom.querySelector("textarea");
    monaco_loader.config({paths: { vs: "https://unpkg.com/monaco-editor@latest/min/vs" }});
    monaco_loader.init().then((monaco) => {
      window.editor = monaco.editor.create(
        controlsDom,
        { language: "css",
        value: textareaDom.value, 
        theme: "vs-dark",
        minimap: {enabled: false},
        scrollBeyondLastLine: false 
        }
      );
      window.editor.onDidChangeModelContent((event) => {
        textareaDom.value = editor.getValue()
        textareaDom.dispatchEvent(new Event('change'));
      });;
    });
    document.querySelector('li#settings_plugin_customcss_link').onclick = async function(){
        await new Promise(r => setTimeout(r, 100));
        window.editor.setValue(textareaDom.value);
        window.editor.layout();
    }
})();
</script>
<form class="form-vertical">
  <div class="control-group">

    <div class="header">
      <span class="control-label">Custom CSS</span>
      <div class="settings">
        <button type="button" onclick="editor.getAction('editor.action.formatDocument').run();">Format</button>
      </div>
    </div>

    <div class="controls">
      <textarea rows="8" class="block monospace" height="100%" data-bind="value: settings.plugins.customcss.css" style="display:none"></textarea>
    </div>
  </div>
</form>


